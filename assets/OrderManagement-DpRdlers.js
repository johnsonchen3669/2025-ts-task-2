import{a as L,d as C,u as $,o as R,b as O,e as i,f as u,g as e,m as x,t as o,F as f,n as k,r as g,w as P,q as D,p as v}from"./main-B354yc8Z.js";import{M as A,_ as T}from"./DeleteModal.vue_vue_type_script_setup_true_lang-24ECG-lv.js";const z="https://ec-course-api.hexschool.io",S="tttom3669",h=L.create({baseURL:z});h.interceptors.request.use(n=>{const p=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1");return p&&(n.headers.Authorization=p),n},n=>Promise.reject(n));h.interceptors.response.use(n=>Promise.resolve(n),n=>Promise.reject(n.response.data));const N=n=>h.get(`/v2/api/${S}/admin/orders`,{params:n}),B=n=>h.delete(`/v2/api/${S}/admin/order/${n}`),E={class:"modal-dialog modal-dialog-centered modal-lg"},U={class:"modal-content rounded-lg"},V={class:"modal-body"},W={id:"modalOrderNumber"},q={id:"modalOrderDate"},F={id:"modalCustomerName"},j={id:"modalShippingAddress"},G={id:"modalCustomerEmail"},H={id:"modalCustomerPhone"},I={class:"table table-bordered"},J={class:"h5 text-end"},K={id:"modalOrderAmount",class:"text-danger"},Q=C({__name:"OrderDetailModal",props:{order:{}},setup(n,{expose:p}){const a=n,m=$("modalRef");let l=null;return R(()=>{m.value&&(l=new A(m.value))}),O(()=>{l&&l.dispose()}),p({openModal:()=>{l&&l.show()},closeModal:()=>{l&&l.hide()}}),(_,t)=>(u(),i("div",{ref_key:"modalRef",ref:m,class:"modal fade",id:"orderDetailModal",tabindex:"-1","aria-labelledby":"orderDetailModalLabel","aria-hidden":"true"},[e("div",E,[e("div",U,[t[13]||(t[13]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"orderDetailModalLabel"},"訂單詳細資訊"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",V,[e("p",null,[t[0]||(t[0]=e("strong",null,"訂單編號:",-1)),t[1]||(t[1]=x()),e("span",W,o(a.order.id),1)]),e("p",null,[t[2]||(t[2]=e("strong",null,"日期:",-1)),e("span",q,o(new Date(a.order.create_at*1e3).toLocaleDateString()),1)]),e("p",null,[t[3]||(t[3]=e("strong",null,"客戶名稱:",-1)),e("span",F,o(a.order.user.name),1)]),e("p",null,[t[4]||(t[4]=e("strong",null,"地址:",-1)),e("span",j,o(a.order.user.address),1)]),e("p",null,[t[5]||(t[5]=e("strong",null,"Email:",-1)),e("span",G,o(a.order.user.email),1)]),e("p",null,[t[6]||(t[6]=e("strong",null,"聯絡電話:",-1)),e("span",H,o(a.order.user.tel),1)]),t[10]||(t[10]=e("hr",null,null,-1)),t[11]||(t[11]=e("h6",null,"訂購商品",-1)),e("table",I,[t[7]||(t[7]=e("thead",null,[e("tr",null,[e("th",null,"商品名稱"),e("th",null,"數量"),e("th",null,"小計")])],-1)),e("tbody",null,[(u(!0),i(f,null,k(a.order.products,b=>(u(),i("tr",{key:b.id},[e("td",null,o(b.product.title),1),e("td",null,o(b.qty),1),e("td",null,o(b.final_total.toLocaleString("zh-TW")),1)]))),128))])]),t[12]||(t[12]=e("hr",null,null,-1)),e("p",J,[t[8]||(t[8]=e("strong",null,"總金額:",-1)),e("span",K,o(a.order.total.toLocaleString("zh-TW")),1),t[9]||(t[9]=x(" 元 ",-1))])]),t[14]||(t[14]=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-outline-secondary rounded-lg","data-bs-dismiss":"modal"}," 關閉 ")],-1))])])],512))}}),X={class:"card shadow-sm rounded-lg flex-grow-1"},Y={class:"card-body p-4"},Z={class:"table-responsive"},ee={class:"table table-hover align-middle"},te={class:"order-number"},le={class:"text-nowrap"},se=["onClick"],oe=["onClick"],ne={class:"d-flex justify-content-center mt-4"},ae={class:"pagination"},de={class:"page-item"},re=["disabled"],ie={class:"page-item"},ue=["onClick","disabled"],pe={class:"page-item"},ce=["disabled"],_e=C({__name:"OrderManagement",setup(n){const p=$("orderDetailModalRef"),a=$("deleteModalRef"),m=g({create_at:0,id:"",is_paid:!1,total:0,message:"",products:{},user:{address:"",email:"",name:"",tel:""},num:0}),l=g("1"),y=g([]),c=g({total_pages:0,current_page:0,has_pre:!1,has_next:!1,category:""}),_=async()=>{try{const r=await N({page:l.value});y.value=r.data.orders,c.value=r.data.pagination}catch{alert("取得訂單列表失敗")}};R(()=>{_()}),P(l,()=>{_()});const t=r=>{m.value=r,p.value?.openModal()},b=r=>{a.value?.openModal(()=>w(r))},w=async r=>{try{await B(r)}catch{alert("刪除訂單失敗")}finally{_()}};return(r,d)=>(u(),i(f,null,[e("div",X,[e("div",Y,[e("div",Z,[e("table",ee,[d[2]||(d[2]=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"日期"),e("th",{scope:"col"},"訂單編號"),e("th",{scope:"col"},"品項"),e("th",{scope:"col"},"金額"),e("th",{scope:"col"},"訂單狀態"),e("th",{scope:"col"})])],-1)),e("tbody",null,[(u(!0),i(f,null,k(y.value,s=>(u(),i("tr",{key:s.id},[e("td",null,o(new Date(s.create_at*1e3).toLocaleDateString("zh-TW")),1),e("td",te,o(s.id),1),e("td",null,o(Object.keys(s.products).length),1),e("td",null,o(s.total),1),e("td",null,[e("span",{class:v(["badge",{"bg-success":s.is_paid,"bg-danger":!s.is_paid}])},o(s.is_paid?"已付款":"未付款"),3)]),e("td",le,[e("button",{onClick:M=>t(s),type:"button",class:"btn btn-sm btn-outline-dark rounded-lg me-2"}," 查看 ",8,se),e("button",{onClick:M=>b(s.id),type:"button",class:"btn btn-sm btn-outline-danger rounded-lg"}," 刪除 ",8,oe)])]))),128))])])]),e("nav",ne,[e("ul",ae,[e("li",de,[e("button",{onClick:d[0]||(d[0]=s=>l.value=String(Number(l.value)-1)),disabled:!c.value?.has_pre,type:"button",class:v(["page-link",{disabled:!c.value?.has_pre}]),"aria-label":"Previous"},[...d[3]||(d[3]=[e("span",{"aria-hidden":"true"},"«",-1)])],10,re)]),(u(!0),i(f,null,k(c.value?.total_pages,s=>(u(),i("li",ie,[e("button",{onClick:M=>l.value=s.toString(),disabled:l.value===s.toString(),type:"button",class:v(["page-link",{active:l.value===s.toString()}])},o(s),11,ue)]))),256)),e("li",pe,[e("button",{onClick:d[1]||(d[1]=s=>l.value=String(Number(l.value)+1)),disabled:!c.value?.has_next,class:v(["page-link",{disabled:!c.value?.has_next}]),type:"button","aria-label":"Next"},[...d[4]||(d[4]=[e("span",{"aria-hidden":"true"},"»",-1)])],10,ce)])])])])]),D(Q,{ref_key:"orderDetailModalRef",ref:p,order:m.value},null,8,["order"]),D(T,{ref_key:"deleteModalRef",ref:a,title:"刪除訂單",content:"確定要刪除該訂單嗎？"},null,512)],64))}});export{_e as default};
